## 병목 예상 쿼리 보고서

### 병목이 예상되는 상황
#### 인기 상품 조회
```sql
-- 생성된 주문 상품 기준으로 최근 3일 간 인기 상품 5건 조회
SELECT 주문상품.상품ID, COUNT(*)
FROM 주문
INNER JOIN 주문상품
   ON 주문.ID = 주문상품.주문ID
WHERE 주문.상태 IN ('대기', '결제중', '결제완료')
  AND 주문.생성일 >= (오늘 - 3일 전) 
GROUP BY 주문상품.상품ID
ORDER BY COUNT(*) DESC
LIMIT 5;
```
- 문제: `order_item` 테이블이 수십만 건 이상이면 조회 성능 저하
### 병목 처리 전략
| 전략     | 설명                             |
|--------|--------------------------------|
| 집계 테이블 운영 | 인기 상품 집계 결과를 별도 테이블에 유지        |
| 배치 처리 | 조회가 잦은 데이터는 일정 주기로 정리/요약       |
| 컬럼 인덱싱 | 단일 인덱스 또는 복합 인덱스 지정으로 조회 성능 향상 |

- 조회 성능을 위해 별도 집계 테이블 (e.g. ProductSalesStats) 운영 + 주문 시 업데이트
- 배치 작업/스케줄러로 3일간 집계하여 별도 캐시 저장
- 컬럼 인덱싱
  - 복합 인덱스: `(주문상태, 주문생성일)`에 적용
    - 만약 `주문생성일`이 시간 정보를 포함하는 경우 카디널리티가 더 높지만 `주문생성일`을 복합인덱스의 앞쪽에 위치시킬 경우 `주문상태` 인덱스는 '필터링 조건'으로 활용되기에 쿼리의 효율이 떨어질 수 있음
    - `주문상태`가 앞쪽에 와야 '작업 범위 조건'으로 인덱스 활용 가능
